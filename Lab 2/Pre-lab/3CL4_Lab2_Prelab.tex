\documentclass[12pt]{article}
\usepackage[letterpaper, margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{subcaption}
\graphicspath{{./Figures/}}
\usepackage{hyperref}
\usepackage{parskip}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{enumitem}

\title{ELECENG 3CL4 Lab 2 Pre-lab}
\author{
    Aaron Pinto \\
    pintoa9 \\
    L02
    \and
    Raeed Hassan \\
    hassam41 \\
    L02
}

\begin{document}

\maketitle
\clearpage

\section{Description of Laboratory Equipment}
\textbf{Pre-lab Question 1} \\ % Provide a complete derivation of the step response of the model G(s).
The step response of the model $G(s)$ is in Equation~\ref{eq:1}. The derivation of the step response is shown below.
\begin{equation} \label{eq:1}
\begin{aligned}[b]
    \mathscr{L}^{-1} \left\{ G(s) \frac{1}{s} \right\} &= \mathscr{L}^{-1} \left\{ \frac{A} {s(s\tau_m + 1)} \frac{1}{s} \right\} \\
    &= A \ \mathscr{L}^{-1} \left\{ \frac{1} {s^2(s\tau_m + 1)} \right\} \\
    &= A \ \mathscr{L}^{-1} \left\{ \frac{{\tau_m}^2} {s\tau_m + 1} - \frac{\tau_m}{s} + \frac{1}{s^2} \right\} \\
    &= A \left[ \mathscr{L}^{-1} \left\{ \frac{{\tau_m}^2} {s\tau_m + 1} \right\} - \mathscr{L}^{-1} \left\{ \frac{\tau_m}{s} \right\} + \mathscr{L}^{-1} \left\{ \frac{1}{s^2} \right\} \right] \\
    &= A \left[ \tau_m e^{-\frac{t}{\tau_m}} - \tau_m u(t) + t \right]
\end{aligned}
\end{equation}

\textbf{Pre-lab Question 2} \\ %Is that step response bounded? Justify your answer.
The step response is not bounded because the term t is not bounded.

\section{Closed Loop System Identification}
\textbf{Pre-lab Question 3}
\begin{enumerate}[label=(\roman*)]
    \item The output signal of the model can be expressed as:
    \begin{multline*}
        Y(s) = \frac{G_c(s)G(s)}{1+H(s)G_c(s)G(s)}R(s) + \frac{G(s)}{1+H(s)G_c(s)G(s)}T_d(s) \\ + \frac{H(s)G_c(s)G(s)}{1+H(s)G_c(s)G(s)}N(s)
    \end{multline*}
    If we neglect the effects of the disturbance $T_d(s)$ and the noise $N(s)$, we are left with:
    \begin{equation*}
        Y(s) = \frac{G_c(s)G(s)}{1+H(s)G_c(s)G(s)}R(s)
    \end{equation*}
    When $H(s) = 1$ and we let $\Theta(s) = Y(s)$, we can find the transfer function $T(s)$ in Equation~\ref{eq:3} (idk why this isn't working), which is equal to Equation 4a from the lab document.
    \begin{equation} \label{eq:3}
    \begin{aligned}[b]
        T(s) &= \frac{\Theta(s)}{R(s)} \\
        &= \frac{\frac{G_c(s)G(s)}{1+H(s)G_c(s)G(s)}R(s)}{R(s)} \\
        &= \frac{G(s)G_c(s)}{1+G(s)G_c(s)}
    \end{aligned}
    \end{equation}
    \item When we substitute $G(s) = \frac{A}{s(s\tau_m+1)}$ and $G_c(s) = K$ into Equation~\ref{eq:3}, and then substituting $\sqrt{\frac{KA}{\tau_m}} = \omega_n $ and $\frac{1}{2\omega_n\tau_m}$ into the result, we can derive Equation~\ref{eq:4} which is equal to Equation 4b from the lab document:
    \begin{equation} \label{eq:4}
    \begin{aligned}[b]
        T(s) &= \frac{G(s)G_c(s)}{1+G(s)G_c(s)} \\
        &= \frac{\frac{A}{s(s\tau_m+1)}K} {1 + \frac{A}{s(s\tau_m+1)} K} \\
        &= \frac{KA}{s(s\tau_m+1)(1+\frac{A}{s(s\tau_m+1)}K)} \\
        &= \frac{KA}{s(s\tau_m + 1 + \frac{KA}{s})} \\
        &= \frac{KA}{s^2\tau_m + s + KA} \\
        &= \frac{KA / \tau_m}{s^2 + (1/\tau_m)s + KA / \tau_m} \\
        &= \frac{\omega_n^2}{s^2 + 2\zeta\omega_ns + \omega_n^2}
    \end{aligned}
    \end{equation}
\end{enumerate}

\textbf{Pre-lab Question 4} \\
When given $\zeta$ and $\omega_n$, we can derive Equation~\ref{eq:tau_m} for $\tau_m$:
\begin{equation} \label{eq:tau_m}
\begin{aligned}[b]
    \zeta &= \frac{1}{2\omega_n\tau_m} \\
    \tau_m &= \frac{1}{2\omega_n\zeta}
\end{aligned}
\end{equation}
By substituting Equation~\ref{eq:tau_m} into the equation for $\omega_n$, we can derive Equation~\ref{eq:A} for $A$:
\begin{equation} \label{eq:A}
\begin{aligned}
    \omega_n &= \sqrt{\frac{KA}{\tau_m}} \\
    \omega_n^2 &= \frac{KA}{\tau_m} \\
    A &= \frac{\omega_n^2\tau_m}{K} \\
    A &= \frac{\omega_n / 2\zeta}{K}
\end{aligned}    
\end{equation}


\subsection{Closed-loop System Identification from the Step Response}
\textbf{Pre-lab Question 5} \\
The percent overshoot is determined at the peak time, $T_p$, of the step response. For the provided step response, this peak time occurs the first time $d\theta_{\text{step}}(t)/dt = 0$, which occurs when $\omega_n\sqrt{1-\zeta^2}t = \pi$. Therefore, the peak time $T_p$ is equal to $\frac{\pi}{\omega_n\sqrt{1-\zeta^2}}$. At the peak time, the peak value of the step response is $1 + \exp\left( -\zeta\pi / \sqrt{1-\zeta^2} \right)$. Therefore, the percent overshoot can be defined as P.O. $= 100\frac{(1 + \exp^{-(\zeta\pi / \sqrt{1-\zeta^2})})-1}{1} = 100\exp\left(\frac{-\zeta\pi}{\sqrt{1-\zeta^2}}\right)$.

\textbf{Pre-lab Question 6} \\
As discussed in the solution to Pre-lab Question 5, the peak time occurs the first time $d\theta_{\text{step}}(t)/dt = 0$, which occurs when $\omega_n\sqrt{1-\zeta^2}t = \pi$. Therefore, the peak time $T_p$ is equal to $\frac{\pi}{\omega_n\sqrt{1-\zeta^2}}$.

\textbf{Pre-lab Question 7} \\
From the equation for P.O., you can calculate $\zeta$ as:
\begin{equation}
\begin{aligned}[b]
    P.O. &= 100\exp\left(\frac{-\zeta\pi}{\sqrt{1-\zeta^2}}\right) \\
    \frac{P.O.}{100} &= \exp\left(\frac{-\zeta\pi}{\sqrt{1-\zeta^2}}\right) \\
    \ln \left( \frac{P.O.}{100} \right) &= \frac{-\zeta\pi}{\sqrt{1-\zeta^2}} \\
    \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2} &= \frac{\zeta^2}{1-\zeta^2} \\
    \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2} &= 1 - \frac{1}{1+\zeta^2} \\
    1 - \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2} &= \frac{1}{1+\zeta^2} \\
    1 + \zeta^2 &= \frac{1}{\left( 1 - \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2} \right)} \\
    \zeta^2 &= \frac{1}{\left( 1 - \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2} \right)} - 1 \\
    \zeta &= \sqrt{\frac{1}{\left( 1 - \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2} \right)} - 1}
    %\zeta^2 &= (1 - \zeta^2) \frac{\left( \ln \left( \frac{P.O.}{100} \right) \right)^2}{\pi^2}
\end{aligned}
\end{equation}
ok lets try something thats probably a bit easier
\begin{equation}
\begin{aligned}[b]
    T_p &= \frac{\pi}{\omega_n\sqrt{1-\zeta^2}} \\
    \omega_n &= \frac{\pi}{T_p\sqrt{1-\zeta^2}} % u substitute ur answer for zeta in here
\end{aligned}
\end{equation}

\subsection{Closed-Loop System Identification using the Frequency Response}
\textbf{Pre-lab Question 8} \\
\begin{equation}
\begin{aligned}[b]
    \frac{d}{d\omega} \left|\omega_n^2 - \omega^2 + j2\zeta\omega_n\omega\right|^2 &= \overbrace{2 (\omega_n^2 - \omega^2 + j2\zeta\omega_n\omega) \frac{d}{d\omega} (\omega_n^2 - \omega^2 + j2\zeta\omega_n\omega)}^{\text{apply chain rule}} \\
    &= 2 (\omega_n^2 - \omega^2 + j2\zeta\omega_n\omega) (-2\omega + j2\zeta\omega_n) \\
    0 &= 4 (\omega_n^2 - \omega^2 + j2\zeta\omega_n\omega) (-\omega + j\zeta\omega_n) \\
    0 &= (\omega_n^2 - \omega^2 + j2\zeta\omega_n\omega) (-\omega + j\zeta\omega_n) \\
    &= (\omega_n^2 - (\omega_n\sqrt{1-2\zeta^2})^2 + j2\zeta\omega_n\sqrt{1-2\zeta^2}) (-\sqrt{1-2\zeta^2} + j\zeta\omega_n)
    &= 
\end{aligned}
\end{equation}

\textbf{Pre-lab Question 9} \\
\begin{equation} \label{eq:9}
\begin{aligned}[b]
    M_p^2 &= \underset{\omega}{\text{max}}\left| T(j\omega) \right|^2 \\
    &= \left| T(j\omega_p) \right|^2 \\
    &= \frac{\omega_n^4}{\left| \omega_n^2 - (\omega_n\sqrt{1-2\zeta^2})^2 + j2\zeta\omega_n^2\sqrt{1-2\zeta^2} \right|^2} \\
    &= \frac{\omega_n^4}{\left| \omega_n^2 - \omega_n^2(1-2\zeta^2) + j2\zeta\omega_n^2\sqrt{1-2\zeta^2} \right|^2} \\
    &= \frac{\omega_n^4}{\left| \omega_n^2 \left( j2\zeta\sqrt{1-2\zeta^2} + 2\zeta^2 \right) \right|^2} \\
    &= \frac{\omega_n^4}{\omega_n^4 (4\zeta^4 + 4\zeta^2 (1-2\zeta^2))} \\
    &= \frac{1}{4\zeta^2 (\zeta^2 + 1 - 2\zeta^2)} \\
    &= \frac{1}{4\zeta^2 (1 - \zeta^2)}
\end{aligned}
\end{equation}

\textbf{Pre-lab Question 10} \\
\begin{equation}
\begin{aligned}[b]
    M_p^2 &= \frac{1}{4\zeta^2 (1 - \zeta^2)} \\
    4\zeta^2 (1 - \zeta^2) &= \frac{1}{M_p^2} \\
\end{aligned}
\end{equation}

\end{document}